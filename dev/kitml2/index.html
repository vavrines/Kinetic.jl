<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>UBE · Kinetic.jl</title><meta name="title" content="UBE · Kinetic.jl"/><meta property="og:title" content="UBE · Kinetic.jl"/><meta property="twitter:title" content="UBE · Kinetic.jl"/><meta name="description" content="Documentation for Kinetic.jl."/><meta property="og:description" content="Documentation for Kinetic.jl."/><meta property="twitter:description" content="Documentation for Kinetic.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="Kinetic.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">Kinetic.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../install/">Installation</a></li><li><a class="tocitem" href="../physics/">Physics</a></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Type</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../type_config/">Configuration</a></li><li><a class="tocitem" href="../type_setup/">Setup</a></li><li><a class="tocitem" href="../type_domain/">Domain</a></li><li><a class="tocitem" href="../type_velocity/">Velocity</a></li><li><a class="tocitem" href="../type_property/">Property</a></li><li><a class="tocitem" href="../type_ib/">Condition</a></li><li><a class="tocitem" href="../type_fvm/">FVM</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Solver</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../solver/">Framework</a></li><li><a class="tocitem" href="../solver_pre/">Preprocess</a></li><li><a class="tocitem" href="../solver_timestep/">Timestep</a></li><li><a class="tocitem" href="../solver_reconstruction/">Reconstruction</a></li><li><a class="tocitem" href="../solver_flux/">Flux</a></li><li><a class="tocitem" href="../solver_update/">Update</a></li><li><a class="tocitem" href="../solver_post/">Postprocess</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Tutorial</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../tutorial/">Examples</a></li><li><a class="tocitem" href="../eg_advection/">Advection diffusion</a></li><li><a class="tocitem" href="../eg_burgers/">Burgers</a></li><li><a class="tocitem" href="../eg_shock/">Shock tube</a></li><li><a class="tocitem" href="../eg_cavity/">Lid-driven cavity</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Parallelization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../parallel/">General</a></li><li><a class="tocitem" href="../para_thread/">Threading</a></li><li><a class="tocitem" href="../para_dist/">Distributed</a></li><li><a class="tocitem" href="../para_cuda/">CUDA</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8" type="checkbox"/><label class="tocitem" for="menuitem-8"><span class="docs-label">Utility</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../api_io/">I / O</a></li><li><a class="tocitem" href="../api_math/">Math</a></li><li><a class="tocitem" href="../api_theory/">Theory</a></li><li><a class="tocitem" href="../api_geo/">Physical space</a></li><li><a class="tocitem" href="../api_phase/">Phase space</a></li><li><a class="tocitem" href="../api_config/">Configuration</a></li><li><a class="tocitem" href="../api_step/">Stepper</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9" type="checkbox" checked/><label class="tocitem" for="menuitem-9"><span class="docs-label">SciML</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../kitml1/">KitML</a></li><li class="is-active"><a class="tocitem" href>UBE</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-10" type="checkbox"/><label class="tocitem" for="menuitem-10"><span class="docs-label">Fortran</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../fortran1/">KitFort</a></li><li><a class="tocitem" href="../fortran2/">Benchmark</a></li></ul></li><li><a class="tocitem" href="../function_index/">Index</a></li><li><a class="tocitem" href="../python/">Python</a></li><li><a class="tocitem" href="../contribution/">Contribution</a></li><li><a class="tocitem" href="../reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">SciML</a></li><li class="is-active"><a href>UBE</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>UBE</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/vavrines/Kinetic.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/vavrines/Kinetic.jl/blob/master/docs/src/kitml2.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Universal-Boltzmann-equation"><a class="docs-heading-anchor" href="#Universal-Boltzmann-equation">Universal Boltzmann equation</a><a id="Universal-Boltzmann-equation-1"></a><a class="docs-heading-anchor-permalink" href="#Universal-Boltzmann-equation" title="Permalink"></a></h1><p>In the following, we present a universal differential equation strategy to construct the neural network enhanced Boltzmann equation. The complicated fivefold integral operator is replaced by a combination of relaxation and neural models. It promises a completely differential structure and thus the neural ODE type training and computing becomes possible. The approach reduces the computational cost up to three orders of magnitude and preserves the perfect accuracy. The detailed theory and implementation can be found in <a href="https://www.sciencedirect.com/science/article/pii/S0021999121004162">Tianbai Xiao &amp; Martin Frank, Using neural networks to accelerate the solution of the Boltzmann equation</a>.</p><p>First we load all the packages needed and set up the configurations.</p><pre><code class="language-julia hljs">using Flux, Kinetic, OrdinaryDiffEq, Plots, SciMLSensitivity, Solaris

begin
    t1 = 3
    nt = 16
    u0 = -5
    u1 = 5
    nu = 80
    v0 = -5
    v1 = 5
    nv = 28
    w0 = -5
    w1 = 5
    nw = 28
    knudsen = 1
    inK = 0
    alpha = 1.0
    omega = 0.5
    nh = 8
end</code></pre><p>The dataset is produced by the fast spectral method, which solves the nonlinear Boltzmann integral with fast Fourier transformation.</p><pre><code class="language-julia hljs">begin
    tspan = (0.0, t1)
    tsteps = linspace(tspan[1], tspan[2], nt)
    γ = heat_capacity_ratio(inK, 3)
    vs = VSpace3D(u0, u1, nu, v0, v1, nv, w0, w1, nw)

    f0 = @. 0.5 * (1 / π)^1.5 *
            (exp(-(vs.u - 1) ^ 2) + exp(-(vs.u + 1) ^ 2)) *
            exp(-vs.v ^ 2) * exp(-vs.w ^ 2)
    prim0 =
        conserve_prim(moments_conserve(f0, vs.u, vs.v, vs.w, vs.weights), γ)
    M0 = maxwellian(vs.u, vs.v, vs.w, prim0)
    mu_ref = ref_vhs_vis(knudsen, alpha, omega)
    τ0 = mu_ref * 2.0 * prim0[end]^(0.5) / prim0[1]

    # Boltzmann
    prob = ODEProblem(boltzmann_ode!, f0, tspan, fsm_kernel(vs, mu_ref))
    data_boltz = solve(prob, Tsit5(), saveat = tsteps) |&gt; Array

    # BGK
    prob1 = ODEProblem(bgk_ode!, f0, tspan, [M0, τ0])
    data_bgk = solve(prob1, Tsit5(), saveat = tsteps) |&gt; Array

    data_boltz_1D = zeros(Float64, axes(data_boltz, 1), axes(data_boltz, 4))
    data_bgk_1D = zeros(Float64, axes(data_bgk, 1), axes(data_bgk, 4))
    for j in axes(data_boltz_1D, 2)
        data_boltz_1D[:, j] .=
            reduce_distribution(data_boltz[:, :, :, j], vs.weights[1, :, :])
        data_bgk_1D[:, j] .=
            reduce_distribution(data_bgk[:, :, :, j], vs.weights[1, :, :])
    end
    f0_1D = reduce_distribution(f0, vs.weights[1, :, :])
    M0_1D = reduce_distribution(M0, vs.weights[1, :, :])

    X = Array{Float64}(undef, vs.nu, 1)
    for i in axes(X, 2)
        X[:, i] .= f0_1D
    end
    Y = Array{Float64}(undef, vs.nu, 1, nt)
    for i in axes(Y, 2)
        Y[:, i, :] .= data_boltz_1D
    end
    M = Array{Float64}(undef, nu, size(X, 2))
    for i in axes(M, 2)
        M[:, i] .= M0_1D
    end
    τ = Array{Float64}(undef, 1, size(X, 2))
    for i in axes(τ, 2)
        τ[1, i] = τ0
    end
end</code></pre><p>Then we define the neural network and construct the unified model with mechanical and neural parts. The training is conducted by Solaris.jl with the Adam optimizer.</p><pre><code class="language-julia hljs">begin
    model_univ = FnChain(
        FnDense(nu, nu * nh, tanh),
        FnDense(nu * nh, nu),
    )
    p_model = init_params(model_univ)

    function dfdt(df, f, p, t)
        df .= (M .- f) ./ τ .+ model_univ(M .- f, p)
    end
    prob_ube = ODEProblem(dfdt, X, tspan, p_model)

    function loss(p)
        sol_ube = solve(prob_ube, Midpoint(), u0 = X, p = p, saveat = tsteps)
        loss = sum(abs2, Array(sol_ube) .- Y)

        return loss
    end

    his = []
    cb = function (p, l)
        display(l)
        push!(his, l)
        return false
    end
end

res = sci_train(loss, p_model, Adam(); cb = cb, maxiters = 200)
res = sci_train(loss, res.u, Adam(); cb = cb, maxiters = 200)</code></pre><p>Once we have trained a hybrid Boltzmann collision term, we could solve it as a normal differential equation with any desirable solvers. Consider the Midpoint rule as an example, the solution algorithm and visualization can be organized.</p><pre><code class="language-julia hljs">ube = ODEProblem(ube_dfdt, f0_1D, tspan, [M0_1D, τ0, (model_univ, res.u)])
sol = solve(
    ube,
    Midpoint(),
    u0 = f0_1D,
    p = [M0_1D, τ0, (model_univ, res.u)],
    saveat = tsteps,
)

plot(
    vs.u[:, vs.nv÷2, vs.nw÷2],
    data_boltz_1D[:, 1],
    lw = 2,
    label = &quot;Initial&quot;,
    color = :gray32,
    xlabel = &quot;u&quot;,
    ylabel = &quot;particle distribution&quot;,
)
plot!(
    vs.u[:, vs.nv÷2, vs.nw÷2],
    data_boltz_1D[:, 2],
    lw = 2,
    label = &quot;Boltzmann&quot;,
    color = 1,
)
plot!(
    vs.u[:, vs.nv÷2, vs.nw÷2],
    data_bgk_1D[:, 2],
    lw = 2,
    line = :dash,
    label = &quot;BGK&quot;,
    color = 2,
)
plot!(
    vs.u[:, vs.nv÷2, vs.nw÷2],
    M0_1D,
    lw = 2,
    label = &quot;Maxwellian&quot;,
    color = 10,
)
scatter!(vs.u[:, vs.nv÷2, vs.nw÷2], sol.u[2], lw = 2, label = &quot;UBE&quot;, color = 3)</code></pre><p><img src="../assets/ube.png" alt/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../kitml1/">« KitML</a><a class="docs-footer-nextpage" href="../fortran1/">KitFort »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Wednesday 24 January 2024 10:59">Wednesday 24 January 2024</span>. Using Julia version 1.9.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
